
# 行业选择与组合支持平台 PRD（A股+H股，中周期长多）

版本：v1.0（交付产品研发团队）  
作者：研究负责人 ×××  
范围：A股 + H股；6–18 个月中周期长多；小体量先行（示例：50万，10%融资，可扩展）  
目标读者：产品、研发、数据、QA、合规、运维

---

## 1. 执行摘要

- 我们将“政策→行业→个股”的四闸门方法论产品化，形成一个可审计、可复用的行业选择与组合支持平台。  
- MVP 聚焦三个能力：
  1) 行业与个股评分引擎（含证据链与门槛纪律）  
  2) 仓位与流动性规划（含公式化门槛与融资约束）  
  3) 监控与告警（事件日历、KPI 跟踪、回撤断路器）
- 数据优先公开源；对“历史快照、公司行为、点时一致预期”提供可插拔的“增强数据包”。

---

## 2. 目标与非目标

- 目标
  - 将研究流程标准化为可重放的“评分-闸门-仓位-复盘”闭环
  - 提供行业/个股的一页式备忘录生成器（证据链接+KPI 树+事件日历）
  - 内置小体量账户的仓位与流动性建议，并可参数化扩展
  - 保留完备的审计轨迹（谁在何时用何证据作何决策）

- 非目标（MVP）
  - 不做全自动交易或量化高频信号
  - 不做跨市场套利或多空对冲执行
  - 不直接对接收费数据商（仅预留接口与开关）

---

## 3. 关键用户与使用场景

- 角色
  - 研究员/行业分析师：维护证据链、评分、备忘录
  - 投资经理（PM）：做“入池/建仓/降级/退出”决策
  - 合规/风控：审计轨迹与阈值配置
  - 管理层：组合大图与回撤/纪律达标率看板

- 核心场景
  - 按周更新行业/个股评分，生成变更建议
  - 新标的入池：三证据齐全、闸门达标
  - 建仓：系统校验估值/趋势/流动性/融资约束
  - 监控：事件日历驱动的告警与回撤断路器
  - 月度复盘：纪律达标率、归因与风格暴露

---

## 4. 业务规则与公式（核心可计算）

### 4.1 行业评分（100分）
\[ Score^{Ind} = 0.35P + 0.25E + 0.25M + 0.15 \times (100 - R^{-}) \]
- \(P\)：政策强度与确定性（主体级别、预算/税惠/标准化）  
- \(E\)：落地证据（订单/招标/设备进场/验收/良率/导入节奏）  
- \(M\)：市场确认（中期动量、>200DMA 占比、景气扩散）  
- \(R^{-}\)：风险（估值拥挤、外部限制、补贴依赖、产能过剩）

门槛：行业入池 \(Score^{Ind} \ge 70\)；≥75 视为核心配置候选。

### 4.2 个股评分（权重建议，100分）
- 质量 Q（30）：ROE 中位、现金流质量（OCF/净利）、毛利趋势、杠杆  
- 估值 V（20）：历史分位与同业对比；成长股用 PEG、EV/Sales  
- 动量/预期 M（25）：中期趋势、EPS 一致预期修正（方向×广度）  
- 政策契合 C（15）：资质/订单/产能与政策条款映射  
- 份额/护城河 S（10）：市占与定价权、客户锁定  
- 红旗 R−（扣分）：应收+存货共振、非标审计、质押高、重大诉讼

门槛：观察 ≥65 且无红旗；建仓 ≥70 + 估值门槛 + 趋势确认。

### 4.3 四闸门（必须全部通过）
- Gate-Industry：行业分达标，处“落地/兑现期”（三证据二满足）  
- Gate-Company：个股分达标，无红旗  
- Gate-Valuation：相对自身5年分位 ≤70%（高速成长 ≤80%，且 PEG ≤1.5）  
- Gate-Execution：价格在长期趋势线上（如 200DMA）；三段式建仓（40/30/30）

### 4.4 流动性与容量（参数化）
- 参与率 \(r\)：A股 10%；H股 8–10%  
- 退出天数 \(D\)：核心 5 天；战术 3 天  
- 最低成交额门槛：\[ ADV_{min} \ge \frac{P_i}{r \times D} \]  
- 绝对底线（默认）：
  - A股：`ADV20 ≥ 3000万人民币` 且 `日换手 ≥ 0.5%`  
  - H股：`ADV20 ≥ 2000万港币` 且 `日换手 ≥ 0.3%`  
- 自由流通占用：持仓/自由流通市值 ≤ 2%（默认）

### 4.5 融资（可用上限 10%）
- 最大总杠杆：1.10x；仅对 A 档核心仓启用  
- 单标融资 ≤ 该标持仓的 30%  
- 去杠杆触发：组合回撤 −10% 或个股 200DMA 有效失守（两周 3 次收盘）→ 归零融资

### 4.6 回撤断路器（不对冲版本）
- −10%：去融资、暂停新开战术仓  
- −20%：战术仓减半、观察清零；入场门槛上调（仅 200DMA 上且动量为正）  
- −30%：仅保留 2–3 只确定性最高核心票（单票≤12%），其余现金

---

## 5. 数据与集成

### 5.1 数据源（优先公开）
- 政策/标准：国务院、NDRC、MIIT、MOF、地方经信/发改/财政官网；标准/名录公示  
- 公司公告：SSE、SZSE、巨潮资讯（cninfo）、HKEXnews、公司 IR  
- 行业高频与贸易：NBS 月度、GACC 海关（HS 章 8486/8541/8542 等）、行业协会（CSIA 等）  
- 市场与指数：交易所官网、指数公司（现成分与方法文件）

### 5.2 增强数据包（可选接入，接口预留）
- 指数历史成分快照与公司行为（CA）/复权  
- 点时财务与一致预期（方向与广度）  
- 卖空/借券与费用（若后续开启对冲）  
- SEMI/WSTS/券商深度库（行业口径统一）

### 5.3 数据治理
- 每条评分项必须存证据源链接与抓取时间戳  
- 字段加“口径标签”（单位、频率、是否预估）  
- 版本化与时间旅行（ScoreSnapshot/ConstituentSnapshot）以消除生存偏差  
- 合规：遵守各网站使用条款与反爬规范；优先 API/公开下载口径；付费源按许可集成

---

## 6. 系统功能清单（MVP → v1.2）

### 6.1 MVP（4–6 周）
- 行业评分台与排名（P/E/M/R− 四维评分拆分展示）  
- 个股筛选器（质量/估值/动量/契合/红旗）  
- 一页式备忘录生成（模板 + 证据链接 + KPI 树 + 事件日历）  
- 仓位与流动性检查（公式校验 + 绝对底线）  
- 组合看板（A/B/C 分层、回撤进度、纪律达标率）  
- 告警中心（事件日历触发、KPI 偏离、趋势与回撤触发）

### 6.2 v1.1（+4–6 周）
- 行业/个股评分可视化历史轨迹与证据对比  
- 组合模拟与再平衡建议（不含自动下单）  
- 估值分位计算器（相对历史/同业）与 PEG 辅助  
- 数据质量监控（缺失、口径漂移、延迟看板）

### 6.3 v1.2（+6–8 周）
- 指数/CA 历史快照接入与回测一致性  
- 估值与一致预期时间序列（方向/广度）  
- 研究团队协作（评审/签核流、审计报告导出）

---

## 7. 信息架构与界面草图（文字说明）

- 全局导航：行业评分｜个股筛选｜备忘录｜组合｜告警｜设置  
- 行业评分页
  - 表格：行业、Score^{Ind}、P/E/M/R− 子分、拥挤度与估值分位、入池状态
  - 右侧：证据链面板（政策/订单/高频）与事件日历
- 个股筛选页
  - 过滤：市值/ADV、质量/估值/动量/契合、红旗开关
  - 结果表：Score^{Eq}、估值分位、PEG、200DMA 状态、证据数
- 备忘录
  - 模板区：论点、三证据、KPI 树、风控与退出触发、仓位建议
  - 一键导出：PDF/Markdown（研发保留 Word 导出接口）
- 组合页
  - A/B/C 分层、目标/当前仓位、现金、融资占比
  - 流动性/容量校验结果、断路器状态
- 告警页
  - 触发列表：类型（事件/KPI/趋势/回撤）、严重度、处理人、状态

---

## 8. 后端服务与接口（示例）

- Score Service
  - POST `/score/industry`  
    请求：`{ "industryId": "...", "P": 80, "E": 70, "M": 65, "Rneg": 30, "evidences": [ { "type": "policy", "url": "...", "ts": "..." } ] }`  
    响应：`{ "ScoreInd": 0.35*P + 0.25*E + 0.25*M + 0.15*(100-Rneg), "snapshotId": "..." }`
  - POST `/score/equity`  
    请求：`{ "ticker": "SHSE:600000", "Q": 75, "V": 60, "M": 70, "C": 65, "S": 55, "Rneg": 0, "evidences": [...] }`  
    响应：`{ "ScoreEq": "...", "flags": [] }`

- Gatekeeper
  - POST `/gate/check`  
    请求：`{ "industryScore": 72, "equityScore": 71, "valuationPercentile": 65, "peg": 1.3, "above200dma": true }`  
    响应：`{ "pass": true, "fails": [] }`

- Liquidity Service
  - POST `/liquidity/check`  
    请求：`{ "ticker":"...", "targetPosition": 70000, "currency": "CNY", "ADV20": 60000000, "turnover": 0.7, "freeFloatMktCap": 5e9, "r": 0.1, "D": 5 }`  
    响应：`{ "advMin": 140000, "absoluteFloorPass": true, "freeFloatCapPass": true, "notes": [] }`

- Portfolio Service
  - POST `/portfolio/construct`（三段式分批 + A/B/C 分层）  
    请求：`{ "capital": 500000, "leverageMax": 1.1, "tiers": [{"name": "A","targetPct":[0.12,0.15]}, ...], "candidates": [ {"ticker":"...","tier":"A","score":78}, ... ] }`  
    响应：建议持仓清单与每笔建仓分批金额

- Evidence API
  - POST `/evidence/attach` 绑定证据链接/文件、时间戳与责任人  
  - GET `/evidence/by-entity`

- Audit & Compliance
  - 全部变更写入 `DecisionLog`（时间、操作者、前后值、证据哈希）

---

## 9. 数据模型（简化草案）

- Industry(id, name, method, parentId)  
- IndustryScoreSnapshot(id, industryId, P, E, M, Rneg, score, ts, editor)  
- Equity(id, ticker, exchange, name, mktCap, freeFloat, adv20, boardLot, currency)  
- EquityScoreSnapshot(id, equityId, Q, V, M, C, S, Rneg, score, ts, editor)  
- EvidenceItem(id, entityType, entityId, type, url, source, ts, note)  
- Portfolio(id, name, capital, leverageMax, createdAt)  
- Position(id, portfolioId, equityId, tier, targetPct, actualPct, entryPlanJSON)  
- Alert(id, type, entityType, entityId, severity, rule, status, ts, assignee)  
- DecisionLog(id, user, action, payloadHash, before, after, ts)

---

## 10. 非功能需求

- 性能
  - 评分计算 < 200ms/请求；组合构建 < 2s（100 标的内）
- 可用性
  - 业务时间 99.5% 可用；夜间批自动重试
- 安全与权限
  - RBAC：研究员（编辑评分/证据），PM（下决策），合规（只读+导出）
  - 数据主权与许可遵从；URL 白名单与速率限制
- 可观测性
  - 指标：评分调用量/失败率、数据延迟、告警处理时长
  - 日志：审计与异常链路

---

## 11. 接口与集成策略

- 数据接入分三类：手工上传（CSV/URL）、半自动抓取（API/公开下载）、付费源连接器（占位）  
- 统一时间戳与时区（CST）；统一货币换算层（CNY/HKD）  
- 公司行为（CA）与指数历史：定义抽象接口 `CAProvider`, `IndexSnapshotProvider`，MVP 提供“空实现 + 手工导入”

---

## 12. 流程与自动化

- 周期任务
  - 周一 09:00 拉取高频/招标更新 → 行业评分建议  
  - 每日收盘：趋势/200DMA 更新、回撤断路器评估  
  - 事件日历驱动：政策/财报/验收节点前 X 日触发提醒

- 人机协作
  - 评分提交需附至少 2 条证据；PM 审批后状态生效  
  - 建仓前自动跑 `gate/check` 与 `liquidity/check`

---

## 13. 测试与验收

- 单元测试
  - 评分公式正确性（边界：0/100/小数精度）  
  - 闸门判定与组合构建（典型/异常路径）
- 集成测试
  - 数据缺失/延迟的容错（默认值与人工提示）  
  - 不同币种/板块手数与流动性校验
- UAT 场景
  - 半导体样板：三证据齐备 → 行业入池 → 个股建仓计划生成  
  - 回撤断路器：模拟 −10/−20/−30% 三级动作  
- 验收标准
  - 研究到决策的“全链路”闭环可走通；所有决策节点有审计记录  
  - 组合看板准确反映仓位、现金、融资与断路器状态

---

## 14. 发布计划与里程碑

- 第 0–1 周：原型设计与数据字典；评分与闸门服务雏形  
- 第 2–3 周：行业/个股评分台、备忘录、证据附件；组合与流动性校验  
- 第 4–6 周（MVP）：告警中心、回撤断路器、权限/审计；UAT + 首批上线（半导体试点）  
- 第 7–10 周（v1.1）：估值分位、历史轨迹、再平衡建议、数据质量监控  
- 第 11–14 周（v1.2）：指数/CA 快照、回测一致性、协作签核流

---

## 15. 风险与应对

- 数据口径不一致 → 字段加口径标签，证据链接强制化  
- 公开源延迟/缺失 → 用户提示 + 手工导入兜底  
- 生存偏差与复权错误 → v1.2 引入 CA/指数历史增强包  
- 小体量账户滑点 → 绝对底线与参与率约束默认开启  
- 合规与许可 → 数据源白名单与使用条款合规审查

---

## 16. 默认参数（可在设置中调优）

- 行业入池：\(Score^{Ind} \ge 70\)；核心：≥75  
- 个股建仓：\(Score^{Eq} \ge 70\)，估值分位 ≤70%（成长 ≤80%，且 PEG ≤1.5），200DMA 在上  
- A/B/C 目标仓位：A 12–15%，B 8–10%，C 3–5%  
- 资金示例：50万自有 + 10% 融资上限（总敞口≤55万）  
- 流动性底线：A股 ADV20≥3000万、H股 ADV20≥2000万；换手与点差阈值如上  
- 断路器：−10/−20/−30% 三阶

---

## 17. 交互文案与导出

- 一页式备忘录导出：Markdown/PDF（研发评估 Word 导出，v1.1）  
- 报表：月度复盘（纪律达标率、归因、风格暴露）、证据清单（可审计）

---

## 18. 开发清单（按组件）

- 前端：行业评分台、个股筛选器、备忘录编辑器、组合看板、告警中心、设置页  
- 后端：Score Service、Gatekeeper、Liquidity Service、Portfolio Service、Evidence/Audit、Scheduler  
- 数据：抓取/导入器、数据字典、质量监控  
- DevOps：日志/指标监控、权限与备份、发布流水线

---

## 19. 未来扩展（路线图）

- 多空对冲与借券成本模型（若策略升级）  
- 更细维的行业口径（如设备/材料子环节的专属 KPI 与证据模板）  
- 回测与归因引擎，支持“指数/CA 历史快照”的无偏验证  
- 移动端轻量看板与告警

---

## 20. 附录：半导体样板（执行要点）

- 行业优先：设备与材料（成熟制程/先进封装）、功率/模拟、先进封装 OSAT  
- 三证据（示例）：招标/验收公告链接、NBS/GACC 高频指标、公司量产与良率里程碑  
- 估值与门槛：子行业 EV/EBITDA / PB–ROE / PEG 口径 + 历史分位  
- 退出触发：200DMA 失守（两周 3 次）、两季 KPI 恶化、估值>85% 分位且无增速加速证据
